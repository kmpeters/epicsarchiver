{% extends "layout.html" %}
{% block body %}

<table><tr>
   <td valign=top>
      
  <form action="{{ url_for('formplot') }}" method=post>
    <table border=0 padding=2>
      
    <tr><td>PV 1:</td><td><input style="width: 200px;" type=text name=pv value='{{pv|safe}}'></td>
        <td>PV 2:</td><td><input style="width: 200px;" type=text name=pv2 value='{{pv2|safe}}'></td></tr>
    <tr><td>  <input type=submit name=submit value='From Present'></td>
      <td colspan=3>
         <select name='timevar' style="width: 100px;">
         {% for c in ago_choices %}
             <option value={{c.val}}  {% if c.val == time_ago %} selected=1 {% endif %}> {{c.label}}</option>
         {% endfor %}
      </select> </tr>
    <tr><td>  <input type=submit name=submit value='Selected Dates'>  </td>
      <td colspan=3> <input type='text' style="width: 175px;"
			    id="date1" name="date1" value="{{odate1|safe }}">
                     <button id='date1_trig'>...</button>
                     <input type='text' style="width: 175px;"
	                    id="date2" name="date2" value="{{odate2|safe }}">
                     <button id='date2_trig'>...</button>		     
                     <script type='text/javascript'>
         function setdate2(cal) {
             var date  = cal.date;
             var time  = date.getTime()
             var f1    = document.getElementById("date1");
             var f2    = document.getElementById("date2");
             var tago  = document.getElementById("timevar");
             var tarr  = new Array();
             tarr      = tago.value.split(' ');
             if (f1 == cal.params.inputField) {
                 var tunit = Date.MINUTE;
                 var tstr = tarr[1].substring(0,2);
                 if      (tstr == 'ho'){ tunit= Date.HOUR;   }
                 else if (tstr == 'we'){ tunit= Date.WEEK;   }
                 else if (tstr == 'da'){ tunit= Date.DAY;   }
                 else if (tstr == 'mo'){ tunit= Date.DAY*31; }
                 time     += tarr[0] * tunit; 
                 var date2 = new Date(time);
                 f2.value  = date2.print("%Y-%m-%d %H:%M:%S");
               }
         }
         Calendar.setup({inputField: "date1",
                        button: "date1_trig", 	 	 
                        onUpdate: setdate2,     
                        ifFormat: "%Y-%m-%d %H:%M:%S",
                        showsTime: true,
                        timeFormat: 24,
                        showOthers: true,
                        singleClick: false,
                        weekNumbers: false });    
         Calendar.setup({inputField: "date2",
                        button: "date2_trig", 	 
                        ifFormat: "%Y-%m-%d %H:%M:%S",
                        showsTime: true,
                        timeFormat: 24,
                        showOthers: true,
                        singleClick: false,
                        weekNumbers: false });    
     </script>
    </td></tr>
      {% if messages is not none %}
        <tr><td>Warnings:</td><td colspan=3>
	    <b>{{ messages }}</b><br> 
	</td></tr>
     {% endif %}


   {% if figure is not none %}
       <tr><td colspan=4>
           <img width=650 src="data:image/png;base64,{{ figure|safe }}"></td>
       </tr>
    {% else %}
         <tr><td> &nbsp;&nbsp; <td colspan=3> <hr> </td>  </tr>       
    {% if pvdata is not none %}
        <tr><td> &nbsp;&nbsp; <td colspan=3> Data for {{ pv }} </td>  </tr>
        <tr><td> &nbsp;&nbsp; <td colspan=3> <hr> </td>  </tr>
        <tr><td></td><td>  Date </td><td> Value </td>  </tr>
        {% for dat in pvdata %}
             <tr><td></td><td> {{ dat.ts }} </td> <td colspan=2> {{ dat.val }} </td> </tr>
        {% endfor %}
        <tr><td> &nbsp;&nbsp; <td colspan=3> <hr> </td>  </tr>
     {% endif %}
    {% if pv2data is not none %}
        <tr><td> &nbsp;&nbsp; <td colspan=3> Data for {{ pv2 }} </td>  </tr>
        <tr><td> &nbsp;&nbsp; <td colspan=3> <hr> </td>  </tr>
        <tr><td></td><td>  Date </td><td> Value </td>  </tr>
        {% for dat in pv2data %}
             <tr><td></td><td> {{ dat.ts }} </td> <td colspan=2> {{ dat.val }} </td> </tr>
        {% endfor %}
        <tr><td> &nbsp;&nbsp; <td colspan=3> <hr> </td>  </tr>
     {% endif %}
  {% endif %}
	     
	     
  <tr><td>Replot</td><td colspan=3>
      {% for c in ago_choices %}
         {% if 'day' not in c.val %}
             <a href="/pvarch/plot/{{pv}}/{{pv2}}/time_ago/{{c.val}}"> {{c.label}}</a>&nbsp;&nbsp;
         {% endif %}
      {% endfor %}
  </td></tr>
  <tr><td>From Present:</td><td colspan=3>
      {% for c in ago_choices %}
        {% if 'day' in c.val %}
               <a href="/pvarch/plot/{{pv}}/{{pv2}}/time_ago/{{c.val}}"> {{c.label}}</a>&nbsp;&nbsp;
        {% endif %}
      {% endfor %}
  </td></tr>
  <tr><td>Data Files:</td><td colspan=3>
    <a href="/pvarch/data/{{pv}}/{{timestr}}/pv1.dat"> {{pv}}</a>
    {% if pv2 is not none %}
    &nbsp;&nbsp;
    <a href="/pvarch/data/{{pv2}}/{{timestr}}/pv2.dat"> {{pv2}}</a>
    {% endif %}
    </td></tr>
</table>

</form>
    
</td><td valign='top'>
  {% if pv2 is not none %}
  <a href="/pvarch/plot/{{pv2}}/{{pv}}/{{timestr}}"> Swap PV 1 and PV 2</a> <p>
    <a href="/pvarch/plot/{{pv}}/None/{{timestr}}">  PV 1 only</a> <p>    
  {% endif %}
  
  <b>Related PVs:</b><p>

  {% for other in related %}
       <a href="/pvarch/plot/{{pv}}/{{other}}/{{timestr}}"> {{other}}</a> <p>
  {% endfor %}
  
  </tr></table>
{% endblock %}
