#!/usr/bin/env python
#
# main pvarch application

import sys, os, time, warnings
import getopt
try:
    import EpicsArchiver
except:
    print 'cannot import EpicsArchiver'
    sys.exit(1)


def show_usage():
    print """    pvcache:   run and interact with pvcaching / mysql process
    
    pvcache -h        shows this message.
    pvcache status    shows cache status, some recent statistics.
    pvcache check     returns # of variables updated in past minute. Should be >1!
    pvcache restart   restarts the caching process
    pvcache add_pv    add a PV to the currently running cache
    pvcache drop_pv   add a PV to the currently running cache
    """
    sys.exit()

def main():
    opts, args = getopt.getopt(sys.argv[1:], "h", ["help"])
    try:
        cmd = args.pop(0)
    except IndexError:
        cmd = 'help'
    for (k,v) in opts:
        if k in ("-h", "--help"): cmd = 'help'

    cache   = EpicsArchiver.Cache()
    master  = EpicsArchiver.ArchiveMaster()
    archiver= EpicsArchiver.Archiver()
    
    if   cmd == 'help':      show_usage()
    elif cmd == 'status':    print 'status ? '
    elif cmd == 'check':     print 'check ?'
    elif cmd == 'add_pv':    print 'add_pv ? '
    elif cmd == 'check':     print 'check?'
    elif cmd == 'start':     print 'start?'
    else: print "pvarch  unknown command '%s'.    Try 'pvarch -h'" % cmd

main()
